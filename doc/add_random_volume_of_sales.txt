declare 
	counter int default 0;
	war_id bigint;
	max_war_id bigint;
	min_war_id bigint;
	prod_id bigint;
	max_volume bigint;
	sold_volume bigint;
	new_volume bigint;
	date_of_sell date;
	date_of_last_arrival date;
begin
	select max(id) into max_war_id from cw."Warehouse";
	select min(id) into min_war_id from cw."Warehouse";
 for counter in 1..quantity loop
   	select trunc(random()*(max_war_id - min_war_id)) + min_war_id into war_id;
	-- get random warhouse_id
	select product_id into prod_id from cw."Volume_of_product" where warehouse_id = war_id
	order by random()
	limit 1;
	-- get random product, which stored in this warehouse
	select stored_volume from cw."Volume_of_product" where product_id = prod_id and warehouse_id = war_id
	into max_volume;
	--get max_volume
	select (trunc(random()*(max_volume - 1)) + 1) into sold_volume;
	-- select random sold volume
	select date_of_arrival into date_of_last_arrival from cw."Consignment_arrival" where warehouse_id = war_id
	order by date_of_arrival desc limit 1;
	-- select last date of arrival to warehouse
	select date(date_of_last_arrival + (trunc(random()  * 6) + 1)* '1 month'::interval) into date_of_sell;
	-- add random 1-7 month from last arrival to sell date
	insert into cw."VolumeOfSales" (warehouse_id, product_id, date, volume)
	values (war_id, prod_id, date_of_sell, sold_volume);
	--inset into VolumeOfSales
	update cw."Volume_of_product" set stored_volume = stored_volume - sold_volume where 
	product_id = prod_id and warehouse_id = war_id;
	--Update Volume_of_Product
  end loop;
  return 0;
end;

